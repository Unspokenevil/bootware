---
- name: Install FUSE for Arch
  become: true
  community.general.pacman:
    name: fuse3
  when: ansible_pkg_mgr == "pacman" and system_architecture == "amd64"

- name: Create AppImages directory for Linux
  ansible.builtin.file:
    mode: "755"
    path: /usr/local/appimages
    owner: root
    state: directory
  become: true
  when: ansible_system == "Linux"

- name: Create AppImageLauncher settings directory for Linux
  ansible.builtin.file:
    dest: "{{ user_home }}/.config"
    mode: "750"
    owner: "{{ user_id }}"
    state: directory
  become: true
  when: ansible_system == "Linux"

- name: Copy AppImageLauncher settings file for Linux
  ansible.builtin.copy:
    dest: "{{ user_home }}/.config/appimagelauncher.cfg"
    force: true
    mode: "644"
    owner: "{{ user_id }}"
    src: appimagelauncher.cfg
  become: true
  when: ansible_system == "Linux"

- name: Install AppImage packages for Linux
  ansible.builtin.get_url:
    dest: /usr/local/appimages/{{ item.name }}
    force: true
    mode: "755"
    owner: root
    url: "{{ item.url }}"
  become: true
  loop: "{{ appimage_packages }}"
  when: ansible_system == "Linux"

- name: Mark role as executed to prevent reruns
  ansible.builtin.set_fact:
    cacheable: true
    appimage_role_executed: true
