- name: Get latest Act version
  uri:
    url: https://formulae.brew.sh/api/formula/act.json
    method: GET
    return_content: yes
  register: act_formula
  when: ansible_system == "Linux"

- name: Download Act for Linux
  become: yes
  unarchive:
    dest: /tmp/
    mode: "755"
    remote_src: yes
    src: >-
      https://github.com/nektos/act/releases/download/v{{
      act_formula.json.versions.stable }}/act_Linux_{{
      act_arch[ansible_architecture] }}.tar.gz
  vars:
    act_arch:
      aarch64: arm64
      x86_64: x86_64
  when: ansible_system == "Linux"

- name: Install Act for Linux
  become: yes
  copy:
    dest: /usr/local/bin/act
    mode: "755"
    src: /tmp/act
  when: ansible_system == "Linux"

- name: Install Act for MacOS
  become: yes
  become_user: "{{ user_account }}"
  community.general.homebrew:
    name: act
  when: ansible_system == "Darwin"

- name: Install Act for Windows
  become: yes
  become_user: "{{ user_account }}"
  community.windows.win_scoop:
    architecture: 64bit
    name: act
  when: ansible_system == "Win32NT"

- name: Get latest GitHub CLI version
  uri:
    url: https://formulae.brew.sh/api/formula/gh.json
    method: GET
    return_content: yes
  register: gh_formula
  when: ansible_system == "Linux"

- name: Install GitHub CLI for Debian distributions
  apt:
    deb: >-
      https://github.com/cli/cli/releases/download/v{{
      gh_formula.json.versions.stable }}/gh_{{ gh_formula.json.versions.stable
      }}_linux_{{ gh_arch[ansible_architecture] }}.deb
  become: yes
  vars:
    gh_arch:
      aarch64: arm64
      x86_64: amd64
  when: ansible_pkg_mgr == "apt"

- name: Install GitHub CLI for Fedora distributions
  become: yes
  dnf:
    disable_gpg_check: yes
    name:
      https://github.com/cli/cli/releases/download/v{{
      gh_formula.json.versions.stable }}/gh_{{ gh_formula.json.versions.stable
      }}_linux_{{ gh_arch[ansible_architecture] }}.rpm
  vars:
    gh_arch:
      aarch64: arm64
      x86_64: amd64
  when: ansible_pkg_mgr == "dnf" and ansible_architecture == "x86_64"

- name: Install GitHub CLI for FreeBSD
  become: yes
  community.general.pkgng:
    name: gh
  when: ansible_system == "FreeBSD"

- name: Install GitHub CLI for MacOS
  become: yes
  become_user: "{{ user_account }}"
  community.general.homebrew:
    name: gh
  when: ansible_system == "Darwin"

- name: Install GitHub CLI for Windows
  become: yes
  become_user: "{{ user_account }}"
  community.windows.win_scoop:
    architecture: 64bit
    name: gh
  when: ansible_system == "Win32NT"
