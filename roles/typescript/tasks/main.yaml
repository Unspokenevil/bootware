- name: Install Node version manager for Unix
  become_user: "{{ user_account }}"
  shell:
    cmd: |
      curl -Sfs https://raw.githubusercontent.com/nvm-sh/nvm/v0.37.0/install.sh | bash
    warn: no
  when: ansible_system in ["Darwin", "Linux"]

- name: Install multiple Node versions for Unix
  become_user: "{{ user_account }}"
  shell:
    cmd: |
      source $HOME/.nvm/nvm.sh
      nvm install 14
      nvm install 12
      nvm install 10
      nvm alias default 14
    executable: /bin/bash
  when: ansible_system in ["Darwin", "Linux"]

- name: Install Node CLI applications for Unix
  become_user: "{{ user_account }}"
  shell:
    cmd: |
      source $HOME/.nvm/nvm.sh
      npm install -g gitmoji-cli @vue/cli
    executable: /bin/bash
  when: ansible_system in ["Darwin", "Linux"]

- name: Install Node CLI applications for Windows
  become_user: "{{ user_account }}"
  shell:
    cmd: npm install -g gitmoji-cli @vue/cli
  when: ansible_system == "Windows"

- name: Create Fish functions directory for Linux
  become_user: "{{ user_account }}"
  file:
    path: "{{ user_home_dir}}/.config/fish/functions"
    state: directory
  when: ansible_system == "Linux"

- name: Download fast NVM Fish for Linux
  become_user: "{{ user_account }}"
  get_url:
    dest: "{{ user_home_dir}}/.config/fish/functions/nvm.fish"
    mode: 0755
    url: https://raw.githubusercontent.com/brigand/fast-nvm-fish/master/nvm.fish
  when: ansible_system == "Linux"
