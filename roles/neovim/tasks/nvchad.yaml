- name: Download NvChad for Unix
  become: yes
  become_user: "{{ user_account }}"
  git:
    depth: 1
    dest: /tmp/NvChad
    repo: https://github.com/NvChad/NvChad
  when: ansible_system != "Win32NT"

- name: Install NvChad for Unix
  become: yes
  become_user: "{{ user_account }}"
  copy:
    dest: "{{ user_home_dir }}/.config/nvim/{{ item }}"
    mode: "755"
    src: "/tmp/NvChad/{{ item }}"
  loop:
    - init.lua
    - lua
  when: ansible_system != "Win32NT"

- name: Remove Neovim settings file for Unix
  become: yes
  become_user: "{{ user_account }}"
  file:
    path: "{{ user_home_dir }}/.config/nvim/init.vim"
    state: absent
  when: ansible_system != "Win32NT"

- name: Install NvChad configuration file for Unix
  become: yes
  become_user: "{{ user_account }}"
  copy:
    dest: "{{ user_home_dir }}/.config/nvim/lua/custom/"
    mode: "664"
    src: chadrc.lua
  when: ansible_system != "Win32NT"

- name: Download NvChad for Windows
  become: yes
  become_user: "{{ user_account }}"
  when: ansible_system == "Win32NT"
  win_shell: >-
    git clone --depth 1 https://github.com/NvChad/NvChad {{ user_home_dir
    }}/AppData/Local/Temp/NvChad

- name: Install NvChad for Windows
  become: yes
  become_user: "{{ user_account }}"
  loop:
    - init.lua
    - lua
  when: ansible_system == "Win32NT"
  win_copy:
    dest: "{{ user_home_dir }}/AppData/Local/nvim/{{ item }}"
    src: "{{ user_home_dir }}/AppData/Local/Temp/NvChad/{{ item }}"

- name: Remove Neovim settings file for Windows
  become: yes
  become_user: "{{ user_account }}"
  when: ansible_system == "Win32NT"
  win_file:
    path: "{{ user_home_dir }}/AppData/Local/nvim/init.vim"
    state: absent

- name: Install NvChad configuration file for Windows
  become: yes
  become_user: "{{ user_account }}"
  when: ansible_system == "Win32NT"
  win_copy:
    dest: "{{ user_home_dir }}/AppData/Local/nvim/lua/custom/"
    src: chadrc.lua
