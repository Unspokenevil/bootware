---
- name: Install Ruby dependencies for Windows
  community.windows.win_scoop:
    name:
      - mingw-winlibs
      - msys2
  when: ansible_system == "Win32NT"

- name: Install Ruby for Alpine
  become: true
  community.general.apk:
    name:
      - ruby
      - ruby-dev
  when: ansible_pkg_mgr == "apk"

- name: Install Ruby for FreeBSD
  become: true
  community.general.pkgng:
    name:
      - ruby
      - ruby27-gems
  when: ansible_system == "FreeBSD"

- name: Install Ruby for Linux
  become: true
  ansible.builtin.package:
    name:
      - ruby
      - ruby-dev
  when: ansible_system == "Linux" and ansible_pkg_mgr != "apk"

- name: Install Ruby for MacOS
  community.general.homebrew:
    name: ruby
  when: ansible_system == "Darwin"

- name: Install Ruby for Windows
  community.windows.win_scoop:
    name: ruby
  when: ansible_system == "Win32NT"

# TODO: Switch to Ansible Gem module.
- name: Install or update Ruby CLI applications for Unix
  ansible.builtin.shell:
    cmd: |
      source {{ ansible_env.HOME }}/.bashrc
      gem install --user-install {{ item }}
    executable: "{{ bash_executable }}"
  loop: "{{ ruby_applications }}"
  when: ansible_system != "Win32NT"

- name: Install or update Ruby CLI applications for Windows
  ansible.builtin.win_shell: |
    If (Get-Command gem -ErrorAction SilentlyContinue) {
        gem install --user-install {{ item }}
    }
    Else {
        {{ scoop_apps }}/ruby/current/bin/gem install --user-install {{ item }}
    }
  environment:
    Path: "{{ scoop_apps }}/ruby/current/bin:{{ ansible_env.Path }}"
  loop: "{{ ruby_applications }}"
  when: ansible_system == "Win32NT"
