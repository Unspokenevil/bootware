- name: Get latest Bottom release
  uri:
    url: https://api.github.com/repos/ClementTsang/bottom/releases/latest
    method: GET
    return_content: yes
  register: bottom_release
  when: ansible_system != "Win32NT"

- name: Install Bottom for Arch distributions
  become_user: "{{ user_account }}"
  shell:
    cmd: yay -Sy --noconfirm bottom-bin
  when: ansible_pkg_mgr == "pacman"

- name: Install Bottom For Debian distributions
  apt:
    deb: >-
      https://github.com/ClementTsang/bottom/releases/download/{{
      bottom_release.json.tag_name }}/bottom_{{ bottom_release.json.tag_name
      }}_amd64.deb
  become: yes
  when: ansible_pkg_mgr == "apt"

- name: Add Bottom package to Fedora repositories
  become: yes
  community.general.copr:
    name: atim/bottom
  when: ansible_pkg_mgr == "dnf"

- name: Install Bottom for Fedora distributions
  become: yes
  dnf:
    name: bottom
  when: ansible_pkg_mgr == "dnf"

- name: Tap Bottom Homebrew repository
  community.general.homebrew_tap:
    name: clementtsang/bottom
  when: ansible_system == "Darwin"

- name: Install Bottom for MacOS
  become_user: "{{ user_account }}"
  community.general.homebrew:
    name: clementtsang/bottom/bottom
  when: ansible_system == "Darwin"

- name: Install Bottom for Windows
  become_user: "{{ user_account }}"
  community.windows.win_scoop:
    architecture: 64bit
    name: bottom
  when: ansible_system == "Win32NT"
